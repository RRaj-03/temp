[
  {
    "question": "What is the half-life of Uranium-235 in years?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "Which enzyme is responsible for unwinding DNA during replication?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the Chandrasekhar limit in solar masses?",
    "difficulty": "expert",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "In quantum mechanics, what does the Heisenberg Uncertainty Principle state about momentum and position?",
    "difficulty": "advanced",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "What is the name of the theoretical boundary around a black hole beyond which nothing can escape?",
    "difficulty": "intermediate",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "Which mathematical theorem states that in any right triangle, the square of the hypotenuse equals the sum of squares of the other two sides?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the time complexity of QuickSort in the worst case scenario?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which treaty established the European Union in 1992?",
    "difficulty": "intermediate",
    "domain": "History & Economics"
  },
  {
    "question": "What is the name of the economic theory that suggests government spending can stimulate economic growth during recessions?",
    "difficulty": "advanced",
    "domain": "History & Economics"
  },
  {
    "question": "In which year did the Chernobyl nuclear disaster occur?",
    "difficulty": "intermediate",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "What is the molecular formula for glucose?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "Which philosopher wrote 'Critique of Pure Reason'?",
    "difficulty": "advanced",
    "domain": "Literature & Arts"
  },
  {
    "question": "What is the name of the process by which cells divide to produce gametes?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "In computer science, what does 'NP-complete' refer to?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the Avogadro constant (approximately)?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "Which hormone regulates blood sugar levels in humans?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the programming paradigm that treats computation as the evaluation of mathematical functions?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In finance, what does 'beta' measure in portfolio theory?",
    "difficulty": "advanced",
    "domain": "History & Economics"
  },
  {
    "question": "What is the name of the statistical measure that describes the linear relationship between two variables?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which element has the highest electronegativity on the periodic table?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the logical fallacy where one assumes that correlation implies causation?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "In thermodynamics, what does the second law state about entropy?",
    "difficulty": "advanced",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "What is the name of the algorithm used in machine learning for finding optimal decision boundaries?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which psychological theory divides the mind into id, ego, and superego?",
    "difficulty": "intermediate",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the mathematical concept that describes the rate of change of a function?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In genetics, what does 'epistasis' refer to?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the economic indicator that measures the total value of goods and services produced?",
    "difficulty": "intermediate",
    "domain": "History & Economics"
  },
  {
    "question": "Which neurotransmitter is primarily associated with the reward pathway in the brain?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the technique used in organic chemistry to separate compounds based on boiling points?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "In game theory, what is a Nash equilibrium?",
    "difficulty": "expert",
    "domain": "History & Economics"
  },
  {
    "question": "What is the name of the phenomenon where light bends when passing through different media?",
    "difficulty": "intermediate",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "Which statistical test is used to determine if there's a significant difference between the means of three or more groups?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the database operation that combines rows from two or more tables?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In molecular biology, what is the central dogma?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the principle in physics that states energy cannot be created or destroyed?",
    "difficulty": "intermediate",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "Which sorting algorithm has the best average-case time complexity?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the economic concept where the cost of the next best alternative is considered?",
    "difficulty": "intermediate",
    "domain": "History & Economics"
  },
  {
    "question": "In linguistics, what does 'morpheme' refer to?",
    "difficulty": "advanced",
    "domain": "Literature & Arts"
  },
  {
    "question": "What is the name of the mathematical function that gives the probability density of a normal distribution?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which organelle is responsible for protein synthesis in eukaryotic cells?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the network protocol that ensures reliable data transmission over the internet?",
    "difficulty": "intermediate",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "In chemistry, what does 'Le Chatelier's Principle' describe?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the cognitive bias where people overestimate their own abilities?",
    "difficulty": "intermediate",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "Which mathematical theorem relates the sides and angles of any triangle?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the process by which RNA is synthesized from DNA?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "In artificial intelligence, what does 'backpropagation' refer to?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the economic theory that explains how supply and demand determine prices?",
    "difficulty": "intermediate",
    "domain": "History & Economics"
  },
  {
    "question": "Which statistical measure indicates how spread out data points are from the mean?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the programming concept where a function calls itself?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In physics, what does 'quantum entanglement' describe?",
    "difficulty": "expert",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "What is the name of the logical structure used in databases to organize data?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which hormone is responsible for regulating the sleep-wake cycle?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the mathematical concept that describes the relationship between exponential and logarithmic functions?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In sociology, what does 'social stratification' refer to?",
    "difficulty": "intermediate",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the algorithm used for finding the shortest path in a weighted graph?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which type of chemical bond involves the sharing of electron pairs between atoms?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the psychological principle that states behavior followed by pleasant consequences is likely to be repeated?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "In calculus, what does the fundamental theorem establish the relationship between?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the data structure that follows Last In, First Out (LIFO) principle?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which process in cellular respiration produces the most ATP molecules?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the economic indicator that measures inflation by tracking price changes in goods and services?",
    "difficulty": "intermediate",
    "domain": "History & Economics"
  },
  {
    "question": "In machine learning, what does 'overfitting' refer to?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the principle in physics that describes the relationship between electric and magnetic fields?",
    "difficulty": "expert",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "Which statistical method is used to find the line of best fit through data points?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the database property that ensures all parts of a transaction are completed successfully?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In genetics, what is the term for genes located on the same chromosome that tend to be inherited together?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the computational complexity class containing decision problems solvable in polynomial time?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which type of research design involves manipulating variables to establish cause-and-effect relationships?",
    "difficulty": "intermediate",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the mathematical operation that finds the area under a curve?",
    "difficulty": "intermediate",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In organic chemistry, what is the term for compounds with the same molecular formula but different structural arrangements?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the design pattern that ensures a class has only one instance?",
    "difficulty": "intermediate",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "Which psychological theory explains behavior through the interaction of thoughts, feelings, and behaviors?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the principle in thermodynamics that relates to the direction of spontaneous processes?",
    "difficulty": "advanced",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "In computer networks, what does 'TCP' stand for?",
    "difficulty": "intermediate",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "What is the name of the statistical technique used to reduce the dimensionality of data while preserving variance?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which cellular process converts light energy into chemical energy?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the economic concept that describes the additional cost of producing one more unit?",
    "difficulty": "advanced",
    "domain": "History & Economics"
  },
  {
    "question": "In formal logic, what does 'modus ponens' refer to?",
    "difficulty": "advanced",
    "domain": "Literature & Arts"
  },
  {
    "question": "What is the name of the algorithm commonly used for public key cryptography?",
    "difficulty": "expert",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "Which part of the brain is primarily responsible for executive functions?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "What is the name of the mathematical theorem that describes the behavior of prime numbers?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "In molecular genetics, what is the term for the complete set of DNA in an organism?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the data mining technique used to find frequent patterns in datasets?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "Which chemical process involves the breakdown of glucose to produce energy?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the philosophical argument that attempts to prove God's existence through reason alone?",
    "difficulty": "expert",
    "domain": "Literature & Arts"
  },
  {
    "question": "In signal processing, what does 'FFT' stand for?",
    "difficulty": "advanced",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "What is the name of the psychological phenomenon where memory performance decreases due to interference?",
    "difficulty": "advanced",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "Which mathematical concept describes the rate at which a function approaches a limit?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the software development methodology that emphasizes iterative development and customer collaboration?",
    "difficulty": "intermediate",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "In immunology, what are the cells responsible for adaptive immune responses called?",
    "difficulty": "advanced",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "What is the name of the economic model that explains how markets reach equilibrium?",
    "difficulty": "advanced",
    "domain": "History & Economics"
  },
  {
    "question": "Which statistical distribution is used to model the time between events in a Poisson process?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the principle in quantum mechanics that states particles can exist in multiple states simultaneously?",
    "difficulty": "expert",
    "domain": "Physics & Astronomy"
  },
  {
    "question": "In computer graphics, what does 'ray tracing' refer to?",
    "difficulty": "advanced",
    "domain": "Technology & Computer Science"
  },
  {
    "question": "What is the name of the cognitive process by which information is encoded, stored, and retrieved?",
    "difficulty": "intermediate",
    "domain": "Psychology & Sociology"
  },
  {
    "question": "Which mathematical theorem establishes the relationship between topology and algebra?",
    "difficulty": "expert",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the cellular structure that contains the cell's genetic material in prokaryotes?",
    "difficulty": "intermediate",
    "domain": "Biology & Chemistry"
  },
  {
    "question": "In artificial intelligence, what does 'reinforcement learning' involve?",
    "difficulty": "advanced",
    "domain": "Mathematics & Computer Science"
  },
  {
    "question": "What is the name of the economic principle that explains why people make irrational financial decisions?",
    "difficulty": "advanced",
    "domain": "History & Economics"
  },
  {
    "question": "Which type of database system stores data in key-value pairs rather than tables?",
    "difficulty": "intermediate",
    "domain": "Technology & Computer Science"
  }
]

[
{
"tag": "Chart Specificity",
"prompt": "Who had a No. 1 hit with 'Billy, Don't Be A Hero' in the 1970s? Please specify which music chart (US Billboard Hot 100, UK Singles Chart, etc.) and include the peak chart position dates for accuracy, as different artists may have topped different regional charts with this song."
},
{
"tag": "Song Context",
"prompt": "Which artist(s) achieved a No. 1 hit with 'Billy, Don't Be A Hero' in the 1970s? Please provide context about the song including the songwriters, release year, and any notable information about different versions or cover versions that were successful."
},
{
"tag": "Artist Comparison",
"prompt": "Who recorded the No. 1 hit version of 'Billy, Don't Be A Hero' in the 1970s? If multiple artists had chart-topping versions, please compare their different releases, chart performance in various countries, and explain which version was more commercially successful overall."
}
]

agent_note = {
    'type_of_task': 'classify the task into ["summary","qna","text_generation","NLI"]',
    'enhanced_prompt' : 'the enhanced prompt ',
    'keywords' : 'keywords with most attention',
    'metric': 'metrics for the new enchanced prompt like structure, clarity, specificity, overall',
    'old_metric': 'metrics for the input prompt like structure, clarity, specificity, overall',
    }
LLM_PROMPT = f"""You are an prompt engineer specialising in enchaning the prompt. 
You have been given an intital prompt and you have to convert it to be best the possible prompt for any LLM. 
Your task is to create a Enchanced Prompt that can be used in by other LLMs and should be output in the below given format:

Agents_note format: {agent_note}

Transcript : {prompt}

Output Formatting Requirements: : 
- Output : Extract the specified details and present them in a well formatted JSON object that matches the 'Agents_note format'. 
- Use JSON syntax.
- Just output the JSON object.
"""

!pip install -q -U transformers datasets accelerate peft trl bitsandbytes xformers

from datasets import load_dataset

# Load a small portion of the Helsinki translation dataset (EN → ES)
dataset = load_dataset("Helsinki-NLP/opus-mt-tc-big-en-es", split="train[:1%]")

# Convert to Mistral-style prompts
def format_example(example):
    en = example["translation"]["en"]
    es = example["translation"]["es"]
    return {
        "prompt": f"Translate the following English sentence to Spanish:\n{en}\nAnswer:",
        "response": es,
    }

dataset = dataset.map(format_example)

from transformers import AutoTokenizer, AutoModelForCausalLM

model_id = "mistralai/Mistral-7B-v0.1"

tokenizer = AutoTokenizer.from_pretrained(model_id)
tokenizer.pad_token = tokenizer.eos_token  # Set pad token

import torch
from peft import LoraConfig, get_peft_model
from transformers import BitsAndBytesConfig

# 8-bit setup using bitsandbytes
bnb_config = BitsAndBytesConfig(
    load_in_8bit=True,
    bnb_8bit_use_double_quant=True,
    bnb_8bit_quant_type="nf4",
    llm_int8_threshold=6.0,
)

model = AutoModelForCausalLM.from_pretrained(
    model_id,
    quantization_config=bnb_config,
    device_map="auto",
    torch_dtype=torch.float16,
)

# LoRA config
lora_config = LoraConfig(
    r=8,
    lora_alpha=16,
    lora_dropout=0.1,
    bias="none",
    task_type="CAUSAL_LM",
    target_modules=["q_proj", "v_proj"],
)

model = get_peft_model(model, lora_config)

from trl import SFTTrainer
from transformers import TrainingArguments

# Prompt formatting
def formatting_func(example):
    return f"{example['prompt']} {example['response']}"

# Training args
training_args = TrainingArguments(
    output_dir="./mistral-lora-checkpoint",
    per_device_train_batch_size=1,
    gradient_accumulation_steps=4,
    learning_rate=2e-4,
    num_train_epochs=1,
    fp16=True,
    logging_steps=10,
    save_strategy="no",
    report_to="none",
)

# Initialize trainer
trainer = SFTTrainer(
    model=model,
    tokenizer=tokenizer,
    train_dataset=dataset,
    formatting_func=formatting_func,
    max_seq_length=512,
    args=training_args,
)

trainer.train()

bnb_config_qlora = BitsAndBytesConfig(
    load_in_4bit=True,
    bnb_4bit_quant_type="nf4",
    bnb_4bit_use_double_quant=True,
    bnb_4bit_compute_dtype=torch.float16,
)

model = AutoModelForCausalLM.from_pretrained(
    model_id,
    quantization_config=bnb_config_qlora,
    device_map="auto",
    torch_dtype=torch.float16,
)

# QLoRA config (same as LoRA, but for 4-bit model)
lora_config_qlora = LoraConfig(
    r=8,
    lora_alpha=16,
    lora_dropout=0.1,
    bias="none",
    task_type="CAUSAL_LM",
    target_modules=["q_proj", "v_proj"]
)

model = get_peft_model(model, lora_config_qlora)

# Inference
prompt = "Translate the following English sentence to Spanish:\nWhere is the nearest train station?\nAnswer:"
inputs = tokenizer(prompt, return_tensors="pt").to("cuda")
output = model.generate(**inputs, max_new_tokens=50)
print(tokenizer.decode(output[0], skip_special_tokens=True))

trainer.save_model("mistral-lora-translator")
tokenizer.save_pretrained("mistral-lora-translator")



import numpy as np
import matplotlib.pyplot as plt
from scipy.cluster.hierarchy import dendrogram, linkage
import gensim.downloader as api

# Load GloVe embeddings
print("Loading GloVe vectors...")
# model = api.load("glove-wiki-gigaword-100")

# Base financial vocabulary
base_keywords = [
    "stock", "bond", "equity", "asset", "liability", "dividend", "interest", "loan", "credit",
    "debit", "balance", "revenue", "profit", "loss", "income", "expense", "budget", "capital",
    "investment", "return", "risk", "hedge", "fund", "portfolio", "market", "index", "exchange",
    "inflation", "valuation", "arbitrage", "liquidity", "leverage", "depreciation", "derivative",
    "futures", "options", "securities", "broker", "dealer", "trader", "share", "diversification",
    "yield", "volatility", "acquisition", "merger", "IPO", "underwriting", "audit", "GDP", "CPI",
    "recession", "forecast", "projection", "mortgage", "subsidy", "default", "insolvency", "rating"
]

# Expand word list
modifiers = ["rate", "value", "price", "trend", "gain", "loss", "cost"]
words = set(base_keywords)
for word in base_keywords:
    for mod in modifiers:
        words.add(f"{word}_{mod}")
    if len(words) > 500:
        break

finance_words = list(words)[:500]

# Filter for words available in GloVe
filtered_words = [w for w in finance_words if w in model]
print(f"Filtered words in GloVe: {len(filtered_words)}")

# Get their embeddings
vectors = np.array([model[w] for w in filtered_words])

# Perform clustering
linked = linkage(vectors, method='ward')

# Plot dendrogram
plt.figure(figsize=(20, 8))
dendrogram(linked,
           labels=filtered_words,
           leaf_rotation=90,
           leaf_font_size=8,
           truncate_mode='lastp',
           p=80)
plt.title('Hierarchical Clustering of Financial Terms')
plt.xlabel('Word Clusters')
plt.ylabel('Distance')
plt.tight_layout()
plt.show()

import gensim.downloader as api
import shutil
import os

# Clear partial download if it exists
path = os.path.expanduser('~/.cache/gensim')
glove_folder = os.path.join(path, 'glove-wiki-gigaword-100')
if os.path.exists(glove_folder):
    print("Removing incomplete GloVe download...")
    shutil.rmtree(glove_folder)

# Try again
print("Retrying GloVe download...")
model = api.load("glove-wiki-gigaword-100")
print("Model loaded successfully!")

import numpy as np
import matplotlib.pyplot as plt
from scipy.cluster.hierarchy import dendrogram, linkage
import gensim.downloader as api
import random

# Clean up any broken GloVe cache if needed
import shutil, os
cache_path = os.path.expanduser('~/.cache/gensim/glove-wiki-gigaword-100')
if os.path.exists(cache_path):
    shutil.rmtree(cache_path)

# Load pretrained GloVe embeddings
print("Downloading GloVe model...")
model = api.load("glove-wiki-gigaword-100")

# Randomly select 500 words from the model's vocab
words = random.sample(model.index_to_key, 500)
vectors = np.array([model[word] for word in words])

# Perform hierarchical clustering
linked = linkage(vectors, method='ward')

# Plot dendrogram
plt.figure(figsize=(18, 7))
dendrogram(linked,
           labels=words,
           leaf_rotation=90,
           leaf_font_size=7)
plt.title("Hierarchical Clustering of 500 Random Words (No Context)")
plt.tight_layout()
plt.show()

from transformers import AutoTokenizer, AutoModelForCausalLM, pipeline
import torch
from collections import defaultdict
from scipy.cluster.hierarchy import fcluster

# Load LLM
model_name = "microsoft/phi-2"  # You can also use mistralai/Mistral-7B-Instruct-v0.1 if you have >16GB VRAM
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(model_name, torch_dtype=torch.float32)

# Inference pipeline
llm = pipeline("text-generation", model=model, tokenizer=tokenizer, device=0 if torch.cuda.is_available() else -1)

# Assuming `linked` and `words` are from earlier hierarchical clustering
num_clusters = 10
cluster_labels = fcluster(linked, num_clusters, criterion='maxclust')

clusters = defaultdict(list)
for word, label in zip(words, cluster_labels):
    clusters[label].append(word)

# Classify function
def classify_text_with_llm(text, clusters_dict):
    prompt = "I have the following clusters of words:\n\n"
    for i, word_list in clusters_dict.items():
        prompt += f"Cluster {i}: {', '.join(word_list[:10])}\n"

    prompt += f"\nWhich cluster best represents the following text?\n\n\"{text}\"\n\nAnswer only with the cluster number."

    response = llm(prompt, max_new_tokens=50, do_sample=False)[0]['generated_text']
    print("\n--- LLM Output ---\n", response)
    # Extract the cluster number from the response
    for i in clusters_dict:
        if f"Cluster {i}" in response or str(i) in response:
            return i
    return "Unclear"

# 🔍 Try it
input_text = "The government announced new tax policies affecting capital gains."
predicted = classify_text_with_llm(input_text, clusters)
print(f"\n➡️ Text classified into Cluster: {predicted}")



%pip install gensim
%pip install --no-cache-dir transformers==4.39.3 accelerate==0.29.3 torch==2.2.2 sentencepiece==0.1.99

You are a prompt enhancer. When given a user prompt, generate 3 enhanced versions of it that improve clarity, usefulness, and effectiveness for AI usage. Each version should differ slightly in tone, detail, or perspective (e.g., creative, analytical, concise).
Return the result strictly in this JSON format:

{ "enhanced_prompt1": "", "enhanced_prompt2": "", "enhanced_prompt3": "" }

Only output the JSON. Do not explain anything.
